<#include "/admin/c.html" />
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<!--easyui资源  -->

<link id="themeStyle" rel="stylesheet" type="text/css"
	href="${path}/js/easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css"
	href="${path}/js/easyui/themes/icon.css">
<script type="text/javascript" src="${path}/js/easyui/jquery.min.js"></script>
<script type="text/javascript"
	src="${path}/js/easyui/jquery.easyui.min.js"></script>

<!-- 引入颜色样式 -->
 <link rel="stylesheet" type="text/css" href="${path}/js/easyui/themes/color.css">   
	<!--国际化 ,easyui表单验证 -->
<script type="text/javascript" src="${path}/js/easyui/locale/easyui-lang-zh_CN.js"></script>
<!-- 自定义验证 -->
<script type="text/javascript" src="${path}/js/easyui/locale/easyui-extend-ams.js"></script>
<title>星密码-店铺分析后台</title>

<script type="text/javascript">
$(function(){
	var menuTree,changePssDlg,changePssForm;
	
	menuTree = $("#menuTree");
	changePssDlg = $("#changePssDlg");
	changePssForm = $("#changePssForm");
	
	menuTree.tree({
		onClick: function(node){
			var text = node.text;
			var url = node.url;
			if(!url){//如果没有配置url,无法打开
				return;	
			}
			var tt = $("#tt");//获取主界面
			if(tt.tabs("exists",text)){//通过"选项卡面板的标题"判断添加的面板是否已经存在了.
				tt.tabs("select",text);//选中对应面板
			}else{
				tt.tabs("add",{
					title:text,
					closable:true,
					content:"<iframe frameborder='0' src='"+url+"' style='width:100%;height:99.1%'></iframe>"
				});
			}
		}
	});
	
	// 4. 定义一个事件处理对象,把事件相关的逻辑都封装到一个对象上(命令对象)
	var cmdObj = {
			createPss : function(){
				changePssForm.form("clear");
				changePssDlg.dialog("open");
			},
			savePss : function(){
			//当所有字段都验证有效的时候返回true
			var isValid = changePssForm.form('validate');
			if (!isValid){
				return;// 返回false终止表单提交
			}
			
			//给表单隐藏域赋值,把登陆用户名传到后台
			
			/*ajax提交*/
			$.ajax({
			     type: 'POST',
			     url:"${path}/ajax/admins/changePss",
			     data: changePssForm.serialize(),
			     cache:false,
			     dataType:'json',  
			     success: function(data){
			    	 data = eval(data);
					 if(data.success){
						// 关闭对话框
						changePssDlg.dialog("close");
						$.messager.alert("温馨提示",data.message,"info",function(){});
						//睡两秒跳登陆页
						setTimeout("location.href ='${path}/login/index'",1000); 
					 }else{
						$.messager.alert("温馨提示",data.message,"info",function(){});
					 }
			     }
			});
		}
		,cancelPss : function(){
			changePssDlg.dialog("close");
		}
	};
	
	// 5. 对页面所有按钮,"统一"做监听
	$("a[data-cmd]").bind("click",function(){
		// 获取cmd内容
		var cmd = $(this).data("cmd");
		// 判断操作
		if(cmd){
			cmdObj[cmd]();
		}
	});
});
</script>

</head>
<body class="easyui-layout">
	<div id="north" border=false data-options="region:'north',split:true"
		style="height: 80px; text-align: center;">
		<h1 style="text-align: center;"></h1>
		
		<div style="position: absolute;right: 10px;top: 5px" >
			<b>欢迎<font color="blue">,</font></b>
			<a href="javascript:void(0)" data-cmd="createPss">修改密码</a>&nbsp;|&nbsp;
			<a href="${path}/login/logout">注销</a>
		</div>
		
	</div>
	
		<!-- 修改密码对话框-->
			<div id="changePssDlg" class="easyui-dialog"
						style="width: 370px;height: 200px;"
						title="修改密码"
						closed="true"
						modal="true"
						buttons="#changePssDlgBtn"
				>
				<form id="changePssForm" method="post">
					<input id="userName" name="userName" type="hidden">
					<table align="center" style="margin-top: 15px;">
						<tr>
							<td>旧密码:</td>
							<td><input style="width:200px" class="easyui-validatebox" name="oldPassword" data-options="required:true"/></td>
						</tr>
						<tr>
							<td>新密码:</td>
							<td><input style="width:200px" class="easyui-validatebox" id="newPassword" name="newPassword" data-options="required:true,validType:['newPassword','length[5,18]']"/></td>
						</tr>
						<tr>
							<td>确认新密码:</td>
							<td><input style="width:200px" class="easyui-validatebox" name="confirmPassword" data-options="required:true,validType:['equalPass[\'#newPassword\']','length[5,18]']" /></td>
						</tr>
					</table>
				</form>
			</div>
			
			<!-- 4. 资源对话框按钮-->
			<div id="changePssDlgBtn">
				<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" data-cmd="savePss">保存</a>
				<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" data-cmd="cancelPss">取消</a>
			</div>
	
	<div id="south" border=false data-options="region:'south',split:true"
		style="height: 60px; text-align: center;">
		2015-2016 Xingmima.com 星密码版权所有 网站备案号：蜀ICP备15035188号-3
	</div>
	<div id="west" data-options="region:'west',split:true" title="功能菜单"
		style="width: 150px;">
		<ul id="menuTree"
			data-options="url:'${path}/ajax/home/getTreeData',animate:true,lines:true">
		</ul>
	</div>
	<div data-options="region:'center'"
		style="padding: 5px; background: #eee;">
		<div id="tt" class="easyui-tabs" fit=true border=false>
			<div title="欢迎使用">
				<h1>欢迎使用</h1>
				<h1>版本:V1.0.0</h1>
			</div>
		</div>
	</div>
</body>
</html>